<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Kalendarz - Zajętość</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 3em; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    .weekend { background-color: #ffdede; }
    .busy { background-color: #c3e6cb; font-weight: bold; }
    h2 { margin-top: 3em; }
  </style>
</head>
<body>

  <h1>Kalendarz dostępności</h1>
  <div id="calendar"></div>

  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSOMEID/pub?gid=0&single=true&output=csv'; // ← zamień na właściwy link CSV

    async function fetchCSVData(url) {
      const response = await fetch(url);
      const text = await response.text();
      const rows = text.trim().split('\n').map(row => row.split(','));
      const headers = rows.shift();
      return rows.map(row => {
        const obj = {};
        headers.forEach((h, i) => obj[h.trim()] = row[i]?.trim());
        return obj;
      });
    }

    function groupByMonth(data) {
      const months = {};
      data.forEach(entry => {
        const date = new Date(entry.Data);
        if (isNaN(date)) return;
        const key = date.toLocaleString('pl-PL', { month: 'long', year: 'numeric' });
        if (!months[key]) months[key] = [];
        months[key].push({ date, initials: entry['Inicjały'] || '', name: entry['Imię i nazwisko'] });
      });
      return months;
    }

    function renderCalendar(grouped) {
      const container = document.getElementById('calendar');
      for (const [month, entries] of Object.entries(grouped)) {
        const table = document.createElement('table');
        const caption = document.createElement('h2');
        caption.textContent = month;
        container.appendChild(caption);
        const thead = document.createElement('thead');
        thead.innerHTML = `<tr><th>Data</th><th>Dzień</th><th>Status</th><th>Inicjały</th></tr>`;
        table.appendChild(thead);
        const tbody = document.createElement('tbody');
        entries.sort((a, b) => a.date - b.date).forEach(entry => {
          const tr = document.createElement('tr');
          const day = entry.date.getDay();
          const isWeekend = (day === 0 || day === 6);
          tr.innerHTML = `
            <td>${entry.date.toLocaleDateString()}</td>
            <td>${entry.date.toLocaleDateString('pl-PL', { weekday: 'long' })}</td>
            <td class="busy">Zajęty</td>
            <td>${entry.initials}</td>
          `;
          if (isWeekend) tr.classList.add('weekend');
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        container.appendChild(table);
      }
    }

    fetchCSVData(sheetUrl)
      .then(groupByMonth)
      .then(renderCalendar)
      .catch(err => console.error('Błąd ładowania danych:', err));
  </script>
</body>
</html>
