<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalendarz Rezerwacji</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .month {
      margin-bottom: 40px;
    }
    h2 {
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      width: 14.28%;
      padding: 10px;
      text-align: center;
      vertical-align: top;
    }
    th {
      background-color: #f0f0f0;
    }
    .weekend {
      background-color: #ffeaea;
    }
    .busy {
      background-color: #d1e7dd;
      font-weight: bold;
      color: #0f5132;
    }
    .initials {
      font-size: 0.8em;
      color: #555;
    }
  </style>
</head>
<body>

<h1>Kalendarz Rezerwacji</h1>
<div id="calendar"></div>

<script>
  const calendarContainer = document.getElementById("calendar");

  async function fetchData() {
    const response = await fetch("https://script.google.com/macros/s/AKfycbwPHru8qeHIou05Vn27lR_5OxMHXpr704RbaGuHgq-LEvf7gvmcEeMOKYdMthsPoCkY/exec");
    return await response.json();
  }

  function getInitials(name) {
    return name.split(" ").map(n => n[0].toUpperCase()).join("");
  }

  function generateCalendar(data) {
    const bookings = {};

    data.forEach(entry => {
      const date = new Date(entry["Data"]);
      const key = date.toISOString().split("T")[0];
      if (!bookings[key]) bookings[key] = [];
      bookings[key].push(entry["Imię i nazwisko"]);
    });

    const now = new Date();
    const currentYear = now.getFullYear();

    for (let month = 0; month < 12; month++) {
      const firstDay = new Date(currentYear, month, 1);
      const lastDay = new Date(currentYear, month + 1, 0);
      const daysInMonth = lastDay.getDate();

      const monthDiv = document.createElement("div");
      monthDiv.className = "month";

      const monthName = firstDay.toLocaleString("pl-PL", { month: "long", year: "numeric" });
      monthDiv.innerHTML = `<h2>${monthName}</h2>`;

      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");

      ["Nd", "Pn", "Wt", "Śr", "Cz", "Pt", "So"].forEach(day => {
        const th = document.createElement("th");
        th.textContent = day;
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      let row = document.createElement("tr");

      let dayOfWeek = firstDay.getDay();
      if (dayOfWeek === 0) dayOfWeek = 7; // make Sunday last

      for (let i = 1; i < dayOfWeek; i++) {
        row.appendChild(document.createElement("td"));
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, month, day);
        const isoDate = date.toISOString().split("T")[0];
        const cell = document.createElement("td");

        let isWeekend = date.getDay() === 0 || date.getDay() === 6;
        if (isWeekend) cell.classList.add("weekend");

        cell.innerHTML = `<strong>${day}</strong>`;

        if (bookings[isoDate]) {
          bookings[isoDate].forEach(name => {
            const initials = getInitials(name);
            cell.classList.add("busy");
            cell.innerHTML += `<br>Zajęty<br><span class="initials">${initials}</span>`;
          });
        }

        row.appendChild(cell);

        if (date.getDay() === 0) {
          tbody.appendChild(row);
          row = document.createElement("tr");
        }
      }

      // Fill empty cells at end
      while (row.children.length < 7) {
        row.appendChild(document.createElement("td"));
      }

      tbody.appendChild(row);
      table.appendChild(tbody);
      monthDiv.appendChild(table);
      calendarContainer.appendChild(monthDiv);
    }
  }

  fetchData().then(data => generateCalendar(data));
</script>

</body>
</html>
